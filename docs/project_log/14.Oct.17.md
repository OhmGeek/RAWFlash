# Project Log
Date: 14th October 2017
Description: A summary of everything that happened over the summer with regards to the project.

## Items
### Processing RAW using libraw and dcraw
After researching into both of these libraries, they are both not ideal candidates for RAW processing.

#### Writing my own RAW reader
I initially considered writing my own RAW processor, either just for DNG or other formats too.

However, I decided against this method, due to the complex nature of the RAW format (or rather, the family of RAW formats). RAW is not one file format, but there are many formats. Each camera manufacturer has their own structure, and some cameras even provide more tags. Therefore, it becomes very difficult to keep this up to date. What might work with one camera, won't work with another. DNG was released by Adobe as a standard, but unfortunately it hasn't been adopted widely. Adobe do provide a converter to DNG though, but that only runs on either Windows or Mac, so for our use it doesn't provide much use (we can't convert to DNG using a separate server, and then read DNG for our image processing needs), as we need to be able to run our system on Linux machines (due to the nature of the cloud system we are designing).

#### LibRaw
This is an entirely C++ based library, designed for processing RAW images. It's compatible with both Windows, Mac and Linux. While it has an impressive feature set, it's quite a heavy library. Also, the documentation I found was somewhat lacking, including simple documentation on how to link it with other C++ projects, which became a problem when I tried writing some example code.

The lack of documentation, coupled with the heavy weight of the library, is why I decided against using this library for my project.

#### dcraw
This is a more common method of doing RAW processing. It's the executable used by many open source RAW image editors, including GIMP plugins, DarkTable, and RawTherapee. The only downside is that it isn't a library at all, but an executable. While the C code exists in its entirety online, it would be difficult to modify the code into a library thanks to use of global variables through the code. 

There are, however, several wrappers for other programming languages, such as 'NDCRaw' by AerisG222 for the .NET Framework. However, .NET is not really designed to run directly on Linux, which is the main OS for most web servers, due to licensing costs with Windows.

DCraw is still not the most ideal though, as it's an executable rather than a library, so therefore we cannot get the image output directly in a form within main memory, but instead we have to store it on hard disk and then read that output file. For speed, this isn't ideal as main memory is much faster than an HDD (or even an SSD). However, it's not easily avoidable. 
##### JDcraw
I therefore embarked on a project over summer called [JDCraw](https://github.com/OhmGeek/JDCRaw) which is a wrapper for the Java programming language, which is far more platform independent.

This library can be used to export the file from RAW (many different types, including DNG and NEF), to two possible file formats: PPM and TIFF. The former isn't really supported by many Java based image processing libraries, but the latter is more supported (at least with the standard tag structure).

In order to make sure that the library continues working throughout the year, I also wrote unit tests, achieving 74% code coverage according to codecov.io.

### Image Processing Server
I started writing the image processing server properly at the end of September/early October.

The plan was to process a JSON string, with all the instructions contained within it, in order to produce an output.

For test purposes, the file used was located in the Pictures folder of my Home Directory. This will be expanded in the future to load from a separate image storage server.

So far, exposure controls can be modified, using the DCRAW processor (utilizing the JDcraw library from maven), along with the colour space.

The idea is that individual Processor classes shall be written, and each of these will process the file, by reading the JSON file, and adding operations, and then finally executing these. 

Initially, JSON was parsed using a for each loop and a long select statement, but I have since changed this to use a Hashmap, mapping string keys to Runnables (which can then be run to add the operation to the processor queue).

Next steps: write the custom processor, read the tiff file output from dcraw, and add custom image processing algorithms such as haze removal and spot healing

### Frontend 

The frontend has been a very slow component of the project.

I initially created a version using ReactJS, but this had a few problems, mostly with Webpack configurations becoming incorrect, coupled with components not being recognised by webpack due to configuration issues. This, coupled with lack of proper control over CSS without massively overhauling the config, led me to try another method: Vue.JS

After experiment with Vue.JS on several other projects, I decided it was a better framework to use, as components can be given three properties: style, script and template, all within one file. All this without needing to use the JSX format, instead using familiar handlebars notation (which follows HTML really well).

What the entire system boils down to is the front end sending requests to the server (which could either be achieved using Web Sockets or AJAX requests), and displaying the result on the screen when complete. In addition to this, clicking on certain buttons/modifying fields on the screen will modify the string of instructions sent to the server (as JSON). So far, no front end properly exists (aside from attempts to get it looking right, though none of these seem to work fully).

This is a basic objective of the project, and as such it needs to be done soon, but it's so far proving the most difficult component of the project.


### Research

Research sort of hit a slight standstill over summer due to the main problem of how to read RAW files, and the proprietary nature. As a result, there are still a number of vitally important topics to research into, including:

- Highlight/Shadow modification
- Haze Removal algorithms, their efficiency
- A source on how to achieve Gaussian Blur along with Median and Mean (it's a fairly simple operation, but still needs a source)

- Colour adjustment algorithms (including different weightings for skin colour, and different scenes)

- The best algorithm for spot healing.

I also need to continue modifying my Literature Review to ensure I:

- Have as many sources as possible
- Compare sources
- Compare different algorithms, in terms of complexity
- show what the common algorithms are
- Show the various different techniques available at manipulating RAW images
- Show a potential case study of current Open Source RAW Editors, which are quite similar to what i'm trying to implement.
